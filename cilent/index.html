<html>
<script src = https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js></script>
<link rel="stylesheet" href="/cilent/game.css">

<div id = "background">

<div id = "signDiv">
    <title> Login </title>
    <div id="loginTitle">Login</div>
    UserName: <input id = "signDiv-user" type = "text"><br><br>
    Password: <input id = "signDiv-pass" type = "text"><br><br>
    <button class="button" id = "signDiv-signIn">Sign In</button>
    <button class="button" id = "signDiv-signUp">Sign Up</button>
</div>


<div id = "gameDiv" style = "display: inline-block;">


<div width = "1000" height = "500">
<canvas id="myCanvas" width = "800" height = "500" style = "border:1px solid black; float:left; background-color: #4caf55;" ></canvas>

<div id = "player-list-box" style = "width: 200px; height : 500px; float:left; overflow-y:scroll">
    <div style = "font-weight : bold;"> Player List</div><br>
    <div id = "player-list"></div>
</div>
</div>

<br>
<div id = "chat-text" style = "width: 500px; height : 100px; overflow-y:scroll">
    <div> Welcome to KappaLand</div>
</div>

    <form id = "chat-form">
        <input id = "chat-input" type = "text" style = "width:500px">
    </form>


<div id ="character-select">
<button class = "char-select-button" onclick="UpdateCharModel('Tyler1')">
<img id = "Tyler1" src="/cilent/sprites/Tyler1-select.png" alt="char" style="width:60px; height:60px;"><br>Tyler1
</button>
<button class = "char-select-button" onclick="UpdateCharModel('Taeyeon')">
<img id = "Taeyeon" src="/cilent/sprites/Taeyeon-select.png" alt="char" style="width:60px; height:60px;"><br>Taeyeon
</button>
<button class = "char-select-button" onclick="UpdateCharModel('Orge')">
<img id = "Orge" src="/cilent/sprites/Orge-select.png" alt="char" style="width:60px; height:60px;"><br>
Orge
</button>
<br>
</div>

<button id = "kms-button">KMS</button>
<div id = "timeStamp">Time</div>

</div>


<head>


    <script>
        var socket = io();

        var signDiv = document.getElementById('signDiv');
        var signDivUser = document.getElementById('signDiv-user');
        var signDivPass = document.getElementById('signDiv-pass');
        var signDivSignIn = document.getElementById('signDiv-signIn');
        var signDivSignUp = document.getElementById('signDiv-signUp');
        var kmsButton = document.getElementById('kms-button');
        var timeStamp = document.getElementById('timeStamp');
        var playerListDisplay = document.getElementById('player-list');

        var charImg = new Image();
        charImg.src = '/cilent/sprites/Tyler1.png';
        var imgFrameIndex = 50;
        var imgWidth = 50;
        var imgHeight = 60;




        signDivSignIn.onclick = function(){
                socket.emit('signIn', {user: signDivUser.value.trim(), pass: signDivPass.value.trim()});
        };

        signDivSignUp.onclick = function(){
                socket.emit('signUp', {user: signDivUser.value.trim(), pass: signDivPass.value.trim()});
        };

        socket.on('signUpResponse',function(data){
            if (data.success) {
                alert("Sign Up Successful! Log in with Your Username and Password!")
            }
            else
                alert("Sign Up unsuccessful! Name already taken!");

        })


        socket.on('signInResponse',function(data){
            if (data.success) {
                signDiv.style.display = 'none';
                gameDiv.style.display = 'inline-block';
            }
            else
                alert("Sign in unsuccessful");

        })


        kmsButton.onclick = function(){
                socket.emit('kms');
        };



        var chatText = document.getElementById('chat-text');
        var chatForm = document.getElementById('chat-form');
        var chatInput = document.getElementById('chat-input');

        var canvas = document.getElementById('myCanvas').getContext("2d");
        canvas.font = '15px Arial';



        socket.on('addToChat', function(data){
            chatText.innerHTML += '<div>' + data + '</div>';
        })

        chatForm.onsubmit = function(event){
            event.preventDefault();
            socket.emit('sendMsgToServer',chatInput.value);

            chatInput.value = '';
        }


        socket.on('playersInfo',function(data){
            canvas.clearRect(0,0,800,500);

                playerListDisplay.innerHTML = '';

                for (var player of data){
                canvas.fillText(player.username,player.x,player.y);
                playerListDisplay.innerHTML += '<div>' + player.username + '</div>';

                drawChar(player);
                }
        })

        socket.on('Time',function(){
            var date = Date().slice(4,24);
            timeStamp.innerHTML = date;
        })


        document.onkeydown = function(event){
            if(event.keyCode === 68) //d
                socket.emit('keyPress',{inputId:'right', state:true});
            else if(event.keyCode === 83)  //s
                socket.emit('keyPress',{inputId:'down', state:true});
            else if(event.keyCode === 65) //a
                socket.emit('keyPress', {inputId:'left',state:true});
            else if(event.keyCode === 87) //w
                socket.emit('keyPress', {inputId:'up', state: true});
        }

        document.onkeyup = function(event){
            if(event.keyCode === 68) //d
                socket.emit('keyPress',{inputId:'right', state:false});
            else if(event.keyCode === 83)  //s
                socket.emit('keyPress',{inputId:'down', state:false});
            else if(event.keyCode === 65) //a
                socket.emit('keyPress', {inputId:'left',state:false});
            else if(event.keyCode === 87) //w
                socket.emit('keyPress', {inputId:'up', state: false});
        }

        function drawChar(player){
        
            var playersImg = new Image();
            playersImg.src = '/cilent/sprites/'+ player.char + '.png';

            switch(player.lastPosition){
                case 'down':
                    canvas.drawImage(playersImg,0,0,imgWidth,imgHeight,player.x,player.y,imgWidth,imgHeight);
                    break;
                case 'up':
                    canvas.drawImage(playersImg,imgFrameIndex * 1,0,imgWidth,imgHeight,player.x,player.y,imgWidth,imgHeight);
                    break;
                case 'left':
                    canvas.drawImage(playersImg,imgFrameIndex * 2,0,imgWidth,imgHeight,player.x,player.y,imgWidth,imgHeight);
                    break;
                case 'right':
                    canvas.drawImage(playersImg,imgFrameIndex * 3,0,imgWidth,imgHeight,player.x,player.y,imgWidth,imgHeight);
                    break;
            }
        }

        function UpdateCharModel(name){
            charImg.src = '/cilent/sprites/' + name + '.png';
            socket.emit('charUpdate',{charName: name});
        }

    </script>
</head>

</div>
</html>
