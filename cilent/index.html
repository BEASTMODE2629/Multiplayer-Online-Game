<html>
<link rel="stylesheet" href="/cilent/game.css">

<div id = "background">

<div id = "signDiv">
    <title> Login </title>
    <div id="loginTitle">Login</div>
    UserName: <input id = "signDiv-user" type = "text"><br><br>
    Password: <input id = "signDiv-pass" type = "text"><br><br>
    <button class="button" id = "signDiv-signIn">Sign In</button>
    <button class="button" id = "signDiv-signUp">Sign Up</button>
</div>


<div id = "gameDiv" style = "display: inline-block;">

<canvas id="myCanvas" width = "500" height = "500" style = "border:1px solid black;" ></canvas>


<div id = "chat-text" style = "width: 500px; height : 100px; overflow-y:scroll">
    <div> Welcome to KappaLand</div>
</div>

    <form id = "chat-form">
        <input id = "chat-input" type = "text" style = "width:500px">
    </form>


<div id ="character-select">
<img id = "char" src="/cilent/sprites/char.jpg" alt="char" style="width:60px; height:60px;"><br>
Tyler1
</div>

<button id = "kms-button">KMS</button>

</div>


<head>
<script src = https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js></script>


    <script>
        var socket = io();

        var signDiv = document.getElementById('signDiv');
        var signDivUser = document.getElementById('signDiv-user');
        var signDivPass = document.getElementById('signDiv-pass');
        var signDivSignIn = document.getElementById('signDiv-signIn');
        var signDivSignUp = document.getElementById('signDiv-signUp');
        var kmsButton = document.getElementById('kms-button');

        var charImg = new Image();
        charImg.src = '/cilent/sprites/char.png';
        var frameIndex = 50;
        var width = 50;
        var height = 60;




        signDivSignIn.onclick = function(){
                socket.emit('signIn', {user: signDivUser.value.trim(), pass: signDivPass.value.trim()});
        };

        signDivSignUp.onclick = function(){
                socket.emit('signUp', {user: signDivUser.value.trim(), pass: signDivPass.value.trim()});
        };

        socket.on('signUpResponse',function(data){
            if (data.success) {
                alert("Sign Up Successful! Log in with Your Username and Password!")
            }
            else
                alert("Sign Up unsuccessful! Name already taken!");

        })


        socket.on('signInResponse',function(data){
            if (data.success) {
                signDiv.style.display = 'none';
                gameDiv.style.display = 'inline-block';
            }
            else
                alert("Sign in unsuccessful");

        })


        kmsButton.onclick = function(){
                socket.emit('kms');
        };



        var chatText = document.getElementById('chat-text');
        var chatForm = document.getElementById('chat-form');
        var chatInput = document.getElementById('chat-input');

        var canvas = document.getElementById('myCanvas').getContext("2d");
        canvas.font = '15px Arial';



        socket.on('addToChat', function(data){
            chatText.innerHTML += '<div>' + data + '</data>';
        })

        chatForm.onsubmit = function(event){
            event.preventDefault();
            socket.emit('sendMsgToServer',chatInput.value);

            chatInput.value = '';
        }


        socket.on('Move',function(data){
            canvas.clearRect(0,0,500,500);

                for (var player of data){
                canvas.fillText(player.username,player.x,player.y);

                drawChar(player);
                }
            })

        document.onkeydown = function(event){
            if(event.keyCode === 68) //d
                socket.emit('keyPress',{inputId:'right', state:true});
            else if(event.keyCode === 83)  //s
                socket.emit('keyPress',{inputId:'down', state:true});
            else if(event.keyCode === 65) //a
                socket.emit('keyPress', {inputId:'left',state:true});
            else if(event.keyCode === 87) //w
                socket.emit('keyPress', {inputId:'up', state: true});
        }

        document.onkeyup = function(event){
            if(event.keyCode === 68) //d
                socket.emit('keyPress',{inputId:'right', state:false});
            else if(event.keyCode === 83)  //s
                socket.emit('keyPress',{inputId:'down', state:false});
            else if(event.keyCode === 65) //a
                socket.emit('keyPress', {inputId:'left',state:false});
            else if(event.keyCode === 87) //w
                socket.emit('keyPress', {inputId:'up', state: false});
        }

        function drawChar(player){
        
            console.log(player.lastPosition);
            switch(player.lastPosition){
                case 'down':
                    canvas.drawImage(charImg,0,0,width,height,player.x,player.y,width,height);
                    break;
                case 'up':
                    canvas.drawImage(charImg,frameIndex * 1,0,width,height,player.x,player.y,width,height);
                    break;
                case 'left':
                    canvas.drawImage(charImg,frameIndex * 2,0,width,height,player.x,player.y,width,height);
                    break;
                case 'right':
                    canvas.drawImage(charImg,frameIndex * 3,0,width,height,player.x,player.y,width,height);
                    break;
            }
        }
        


    </script>
</head>

</div>
</html>
